<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cálculo de Descontos - Seja Fibra</title>
    <!-- Favicon -->
    <link rel="icon" href="https://raw.githubusercontent.com/sejafibra/descontos/refs/heads/main/faviconsf.ico" type="image/x-icon">    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            padding: 20px;
            background-color: #f8f9fa;
        }
        .card {
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .card-header {
            background-color: #28a745;
            color: white;
            font-weight: bold;
        }
        .logo {
            max-height: 60px;
            margin-bottom: 20px;
        }
        .result-card {
            background-color: #f1f8ff;
            border-left: 4px solid #007bff;
        }
        .os-item {
            border-bottom: 1px solid #dee2e6;
            padding: 10px 0;
        }
        .os-item:last-child {
            border-bottom: none;
        }
        .add-os-btn {
            margin-top: 10px;
        }
        .total-discount {
            font-size: 1.2rem;
            font-weight: bold;
            color: #dc3545;
        }
        .time-diff {
            font-size: 0.9rem;
            color: #6c757d;
        }
        .discount-item {
            margin-bottom: 10px;
            padding: 10px;
            background-color: #fff;
            border-radius: 5px;
            border-left: 3px solid #0d6efd;
        }
        #loadingSpinner {
            display: none;
            margin: 20px auto;
        }
        .city-wide {
            border-left: 3px solid #28a745;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="text-center mb-4">
            <img src="https://sejafibra.net/wp-content/uploads/2023/06/logonovofibra.png" alt="Seja Fibra" class="logo">
            <h1>Cálculo de Descontos</h1>
        </div>
        
        <!-- Formulário de Pesquisa -->
        <div class="card">
            <div class="card-header">
                <i class="fas fa-search"></i> Pesquisar Manutenções
            </div>
            <div class="card-body">
                <form id="searchForm">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="searchCity" class="form-label">Cidade</label>
                            <select class="form-select" id="searchCity" required>
                                <option value="">Selecione uma cidade</option>
                                <option value="Ubatuba">Ubatuba</option>
                                <option value="Caraguatatuba">Caraguatatuba</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="searchNeighborhood" class="form-label">Bairro</label>
                            <select class="form-select" id="searchNeighborhood" required disabled>
                                <option value="">Selecione primeiro a cidade</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="startPeriod" class="form-label">Período Inicial</label>
                            <input type="datetime-local" class="form-control" id="startPeriod" required>
                        </div>
                        <div class="col-md-6">
                            <label for="endPeriod" class="form-label">Período Final</label>
                            <input type="datetime-local" class="form-control" id="endPeriod" required>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="tvPlanValue" class="form-label">Valor do Plano TV (R$)</label>
                            <input type="number" step="0.01" min="0" class="form-control" id="tvPlanValue" required>
                        </div>
                        <div class="col-md-6">
                            <label for="internetPlanValue" class="form-label">Valor do Plano Internet (R$)</label>
                            <input type="number" step="0.01" min="0" class="form-control" id="internetPlanValue" required>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary" id="calculateBtn">
                        <i class="fas fa-calculator"></i> Calcular Descontos
                    </button>
                    <div id="loadingSpinner" class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Carregando...</span>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Problemas Avulsos -->
        <div class="card">
            <div class="card-header">
                <i class="fas fa-tools"></i> Problemas Avulsos do Cliente
            </div>
            <div class="card-body">
                <div id="osContainer">
                    <!-- Itens de OS serão adicionados aqui -->
                </div>
                <button type="button" class="btn btn-secondary add-os-btn" id="addOsBtn">
                    <i class="fas fa-plus"></i> Adicionar OS
                </button>
            </div>
        </div>
        
        <!-- Resultados -->
        <div class="card result-card" id="resultsCard" style="display: none;">
            <div class="card-header">
                <i class="fas fa-file-invoice-dollar"></i> Resultado do Cálculo
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h5>Desconto por Manutenções</h5>
                        <div id="maintenanceResults"></div>
                    </div>
                    <div class="col-md-6">
                        <h5>Desconto por Problemas Avulsos</h5>
                        <div id="osResults"></div>
                    </div>
                </div>
                <hr>
                <div class="text-end">
                    <h4>Total de Descontos: <span id="totalDiscount" class="total-discount">R$ 0,00</span></h4>
                </div>
            </div>
        </div>
    </div>

    <!-- Template para OS Avulsa (hidden) -->
    <template id="osTemplate">
        <div class="os-item">
            <div class="row">
                <div class="col-md-3">
                    <label class="form-label">Tipo de OS</label>
                    <select class="form-select os-type" required>
                        <option value="TV">TV</option>
                        <option value="Internet">Internet</option>
                        <option value="Geral">Geral</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="form-label">Abertura</label>
                    <input type="datetime-local" class="form-control os-start" required>
                </div>
                <div class="col-md-3">
                    <label class="form-label">Execução</label>
                    <input type="datetime-local" class="form-control os-end" required>
                </div>
                <div class="col-md-3 d-flex align-items-end">
                    <button type="button" class="btn btn-danger btn-sm remove-os-btn">
                        <i class="fas fa-trash"></i> Remover
                    </button>
                </div>
            </div>
        </div>
    </template>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Configuração do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyC95aDwbm43uv7UPB7YDT5VjCe5USz2mZ8",
            authDomain: "descontos-4ab4b.firebaseapp.com",
            databaseURL: "https://descontos-4ab4b-default-rtdb.firebaseio.com",
            projectId: "descontos-4ab4b",
            storageBucket: "descontos-4ab4b.appspot.com",
            messagingSenderId: "907559767912",
            appId: "1:907559767912:web:d9974a77e46a5ef08ed0dd"
        };

        // Inicializa o Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const auth = firebase.auth();

        // Mapeamento de bairros por cidade
        const neighborhoods = {
            'Ubatuba': ['Acaraú', 'Barra da Lagoa', 'Barra-Seca', 'Caçandoca', 'Centro', 'Emaús', 'Enseada', 'Estufa 1', 'Estufa 2', 'Ipiranguinha', 'Itaguá', 'Itamambuca', 'Jardim Carolina', 'Lagoinha', 'Lázaro', 'Marafunda', 'Maranduba', 'Parque Dos Ministérios', 'Parque Guarani', 'Parque Vivamar', 'Pedra Verde', 'Pedreira', 'Perequê-Açú', 'Pereque-Mirim', 'Praia Do Pulso', 'Praia Dura', 'Praia Grande', 'Rio Escuro', 'Santa Rita', 'Sapé', 'Sertão Da Quina', 'Silop', 'Sumaré', 'Sumidouro', 'Taquaral', 'Taquaral (Angelim)', 'Taquaral (Vila Resende)', 'Tenório', 'Toninhas', 'Umuarama', 'Vale Do Sol', 'Vila Sumaré'],
            'Caraguatatuba': ['Alamedas dos Pessegueiros', 'Alamedas das Amendoeiras', 'Alamedas das Cerejeiras', 'Alamedas Das Figueiras', 'Alamedas Dos Castanheiros', 'Araguais', 'Barranco Alto', 'Caputera', 'Casa Branca', 'Centro', 'Cidade Jardim', 'Cond Res Vilaggio Portofino', 'Cond. Beira Mar (Martim De Sá)', 'Cond. Gaivotas', 'Costa Nova', 'Costa Verde', 'Getuba', 'Golfinhos', 'Ilhas Canárias', 'Jaraguazinho', 'Jardim Capricornio', 'Jardim Gaivotas', 'Jardim Primavera', 'Jardim Santa Rosa (Chocolate)', 'Jardim Terralão', 'Martim De Sá', 'Massaguaçu', 'Morro Do Algodão', 'Olaria', 'Parque Imperial', 'Pereque', 'Poiares', 'Ponte Seca', 'Portal Fazendinha', 'Portal Patrimonio', 'Praia Da Mococa', 'Prainha', 'Rio Do Ouro', 'Sumaré', 'Tabatinga', 'Terralão', 'Tocantins', 'Travessão', 'Loteamento Morada Do Mar', 'Indaiá', 'Jardim California', 'Jardim Jaqueira', 'Tinga']
        };

        // Referências do DOM
        const searchCity = document.getElementById('searchCity');
        const searchNeighborhood = document.getElementById('searchNeighborhood');
        const startPeriod = document.getElementById('startPeriod');
        const endPeriod = document.getElementById('endPeriod');
        const tvPlanValue = document.getElementById('tvPlanValue');
        const internetPlanValue = document.getElementById('internetPlanValue');
        const searchForm = document.getElementById('searchForm');
        const osContainer = document.getElementById('osContainer');
        const addOsBtn = document.getElementById('addOsBtn');
        const resultsCard = document.getElementById('resultsCard');
        const maintenanceResults = document.getElementById('maintenanceResults');
        const osResults = document.getElementById('osResults');
        const totalDiscount = document.getElementById('totalDiscount');
        const osTemplate = document.getElementById('osTemplate');
        const calculateBtn = document.getElementById('calculateBtn');
        const loadingSpinner = document.getElementById('loadingSpinner');

        // Estado da aplicação
        let osCount = 0;
        const maxOs = 5;

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            setCurrentDateTime();
            addOsItem(); // Adiciona o primeiro item de OS
            authenticateUser();
        });

        function authenticateUser() {
            // Lista de emails autorizados
            const authorizedEmails = [
                'ana@sejafibra.net',
                'tais@sejafibra.net',
                'eduarda@sejafibra.net',
                'alissia@sejafibra.net',
                'juliana@sejafibra.net',
                'isabela@sejafibra.net',
                'bioranss@gmail.com',
                'supervisor@sejafibra.net'
            ];

            // Verifica se já está autenticado
            auth.onAuthStateChanged(user => {
                if (user) {
                    if (authorizedEmails.includes(user.email)) {
                        console.log("Usuário já autenticado:", user.email);
                    } else {
                        signOutAndPromptLogin();
                    }
                } else {
                    promptLogin();
                }
            });
        }

        function promptLogin() {
            const email = prompt("Por favor, insira seu email autorizado:");
            if (!email) {
                alert("Autenticação necessária para usar o sistema.");
                return;
            }

            const password = prompt("Por favor, insira sua senha:");
            if (!password) {
                alert("Autenticação necessária para usar o sistema.");
                return;
            }

            auth.signInWithEmailAndPassword(email, password)
                .then(userCredential => {
                    console.log("Autenticado com sucesso:", userCredential.user.email);
                })
                .catch(error => {
                    console.error("Erro na autenticação:", error);
                    alert("Falha na autenticação. Por favor, verifique seu email e senha.");
                    promptLogin();
                });
        }

        function signOutAndPromptLogin() {
            auth.signOut().then(() => {
                promptLogin();
            });
        }

        function setupEventListeners() {
            // Atualiza bairros quando a cidade muda
            searchCity.addEventListener('change', function() {
                updateNeighborhoods();
            });

            // Form submission
            searchForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Verifica se está autenticado antes de calcular
                if (auth.currentUser) {
                    calculateDiscounts();
                } else {
                    alert("Por favor, faça login para continuar.");
                    promptLogin();
                }
            });

            // Adicionar OS
            addOsBtn.addEventListener('click', function() {
                if (osCount < maxOs) {
                    addOsItem();
                } else {
                    alert('Máximo de 5 OS avulsas permitidas.');
                }
            });

            // Remover OS (delegação de eventos)
            osContainer.addEventListener('click', function(e) {
                if (e.target.classList.contains('remove-os-btn')) {
                    e.target.closest('.os-item').remove();
                    osCount--;
                }
            });
        }

        function updateNeighborhoods() {
            const city = searchCity.value;
            searchNeighborhood.innerHTML = '<option value="">Selecione um bairro</option>';
            
            if (city) {
                searchNeighborhood.disabled = false;
                neighborhoods[city].forEach(neighborhood => {
                    const option = document.createElement('option');
                    option.value = neighborhood;
                    option.textContent = neighborhood;
                    searchNeighborhood.appendChild(option);
                });
            } else {
                searchNeighborhood.disabled = true;
            }
        }

        function setCurrentDateTime() {
            const now = new Date();
            const timezoneOffset = now.getTimezoneOffset() * 60000;
            const localISOTime = new Date(now - timezoneOffset).toISOString().slice(0, 16);
            
            // Define o período inicial como 7 dias atrás
            const sevenDaysAgo = new Date(now - (7 * 24 * 60 * 60 * 1000));
            const sevenDaysAgoISO = new Date(sevenDaysAgo - timezoneOffset).toISOString().slice(0, 16);
            
            startPeriod.value = sevenDaysAgoISO;
            endPeriod.value = localISOTime;
        }

        function addOsItem() {
            const osClone = osTemplate.content.cloneNode(true);
            osContainer.appendChild(osClone);
            osCount++;
        }

        function calculateDiscounts() {
            const city = searchCity.value;
            const neighborhood = searchNeighborhood.value;
            const start = startPeriod.value;
            const end = endPeriod.value;
            const tvValue = parseFloat(tvPlanValue.value) || 0;
            const internetValue = parseFloat(internetPlanValue.value) || 0;

            if (!city || !neighborhood || !start || !end) {
                alert('Preencha todos os campos obrigatórios!');
                return;
            }

            // Converter para objetos Date
            const startDate = new Date(start);
            const endDate = new Date(end);

            if (startDate >= endDate) {
                alert('A data final deve ser maior que a data inicial!');
                return;
            }

            // Mostra spinner e desabilita botão
            calculateBtn.disabled = true;
            loadingSpinner.style.display = 'block';

            // Buscar todas as manutenções e filtrar localmente
            database.ref('maintenances').once('value').then(snapshot => {
                const maintenances = [];
                
                if (snapshot.exists()) {
                    snapshot.forEach(childSnapshot => {
                        const maintenance = childSnapshot.val();
                        const maintenanceStart = new Date(maintenance.startDate);
                        const maintenanceEnd = maintenance.endDate ? new Date(maintenance.endDate) : new Date();
                        
                        // Verifica se está no período selecionado
                        if ((maintenanceStart <= endDate && maintenanceEnd >= startDate)) {
                            // Verifica se é do bairro selecionado OU se é uma manutenção que afeta toda a cidade
                            if (maintenance.neighborhood === neighborhood || 
                                (maintenance.isCityWide && maintenance.city === city)) {
                                maintenances.push({
                                    ...maintenance,
                                    id: childSnapshot.key,
                                    isCityWide: maintenance.isCityWide || false
                                });
                            }
                        }
                    });
                }

                // Processar OS avulsas
                const osItems = processOsItems();

                // Calcular descontos
                const discounts = calculateAllDiscounts(maintenances, osItems, tvValue, internetValue, startDate, endDate);

                // Exibir resultados
                displayResults(discounts, tvValue, internetValue);
            })
            .catch(error => {
                console.error('Erro ao buscar manutenções:', error);
                alert('Erro ao calcular descontos. Por favor, verifique se você está autenticado corretamente.');
            })
            .finally(() => {
                // Esconde spinner e habilita botão
                calculateBtn.disabled = false;
                loadingSpinner.style.display = 'none';
            });
        }

        function processOsItems() {
            const osItems = [];
            const osElements = osContainer.querySelectorAll('.os-item');
            
            osElements.forEach(osElement => {
                const type = osElement.querySelector('.os-type').value;
                const start = osElement.querySelector('.os-start').value;
                const end = osElement.querySelector('.os-end').value;
                
                if (start && end) {
                    osItems.push({
                        type,
                        startDate: start,
                        endDate: end
                    });
                }
            });
            
            return osItems;
        }

        function calculateAllDiscounts(maintenances, osItems, tvValue, internetValue, periodStart, periodEnd) {
            // Valores por minuto (considerando 30 dias no mês)
            const tvPerMinute = tvValue > 0 ? tvValue / (30 * 24 * 60) : 0;
            const internetPerMinute = internetValue > 0 ? internetValue / (30 * 24 * 60) : 0;

            // Inicializa totais
            let totalTvDiscount = 0;
            let totalInternetDiscount = 0;
            let maintenanceDetails = [];
            let osDetails = [];

            // Calcula descontos por manutenções
            maintenances.forEach(maintenance => {
                const maintenanceStart = new Date(maintenance.startDate);
                const maintenanceEnd = maintenance.endDate ? new Date(maintenance.endDate) : new Date();
                
                // Ajusta para o período selecionado
                const effectiveStart = maintenanceStart < periodStart ? periodStart : maintenanceStart;
                const effectiveEnd = maintenanceEnd > periodEnd ? periodEnd : maintenanceEnd;
                
                const durationMinutes = (effectiveEnd - effectiveStart) / (1000 * 60);
                
                if (durationMinutes > 0) {
                    let tvMinutes = 0;
                    let internetMinutes = 0;
                    
                    if (maintenance.problemType === 'TV') {
                        tvMinutes = durationMinutes;
                    } else if (maintenance.problemType === 'Internet') {
                        internetMinutes = durationMinutes;
                    } else { // Geral - afeta ambos
                        tvMinutes = durationMinutes;
                        internetMinutes = durationMinutes;
                    }
                    
                    const tvDiscount = tvMinutes * tvPerMinute;
                    const internetDiscount = internetMinutes * internetPerMinute;
                    
                    totalTvDiscount += tvDiscount;
                    totalInternetDiscount += internetDiscount;
                    
                    maintenanceDetails.push({
                        type: maintenance.problemType,
                        start: formatDateTime(maintenance.startDate),
                        end: maintenance.endDate ? formatDateTime(maintenance.endDate) : 'Em andamento',
                        duration: formatDuration(durationMinutes),
                        tvDiscount: tvDiscount.toFixed(2),
                        internetDiscount: internetDiscount.toFixed(2),
                        isCityWide: maintenance.isCityWide
                    });
                }
            });

            // Calcula descontos por OS avulsas
            osItems.forEach((os, index) => {
                const osStart = new Date(os.startDate);
                const osEnd = new Date(os.endDate);
                
                const durationMinutes = (osEnd - osStart) / (1000 * 60);
                
                if (durationMinutes > 0) {
                    let tvMinutes = 0;
                    let internetMinutes = 0;
                    
                    if (os.type === 'TV') {
                        tvMinutes = durationMinutes;
                    } else if (os.type === 'Internet') {
                        internetMinutes = durationMinutes;
                    } else { // Geral - afeta ambos
                        tvMinutes = durationMinutes;
                        internetMinutes = durationMinutes;
                    }
                    
                    const tvDiscount = tvMinutes * tvPerMinute;
                    const internetDiscount = internetMinutes * internetPerMinute;
                    
                    totalTvDiscount += tvDiscount;
                    totalInternetDiscount += internetDiscount;
                    
                    osDetails.push({
                        number: index + 1,
                        type: os.type,
                        start: formatDateTime(os.startDate),
                        end: formatDateTime(os.endDate),
                        duration: formatDuration(durationMinutes),
                        tvDiscount: tvDiscount.toFixed(2),
                        internetDiscount: internetDiscount.toFixed(2)
                    });
                }
            });

            return {
                totalTvDiscount,
                totalInternetDiscount,
                totalDiscount: totalTvDiscount + totalInternetDiscount,
                maintenanceDetails,
                osDetails,
                tvPerMinute,
                internetPerMinute
            };
        }

        function displayResults(discounts, tvValue, internetValue) {
            // Limpa resultados anteriores
            maintenanceResults.innerHTML = '';
            osResults.innerHTML = '';

            // Exibe descontos por manutenções
            if (discounts.maintenanceDetails.length > 0) {
                discounts.maintenanceDetails.forEach(detail => {
                    const item = document.createElement('div');
                    item.className = `discount-item ${detail.isCityWide ? 'city-wide' : ''}`;
                    item.innerHTML = `
                        <div><strong>Tipo:</strong> ${detail.type} ${detail.isCityWide ? '(Toda Cidade)' : ''}</div>
                        <div><strong>Período:</strong> ${detail.start} até ${detail.end}</div>
                        <div class="time-diff">
    <strong>Duração:</strong> ${detail.duration}
    ${isDurationOver24(detail.duration) ? '<span style="color:red; font-weight:bold; margin-left:10px;">Incomum - verificar se OS foi finalizada</span>' : ''}
</div>
                        ${detail.tvDiscount > 0 ? `<div><strong>Desconto TV:</strong> R$ ${detail.tvDiscount}</div>` : ''}
                        ${detail.internetDiscount > 0 ? `<div><strong>Desconto Internet:</strong> R$ ${detail.internetDiscount}</div>` : ''}
                    `;
                    maintenanceResults.appendChild(item);
                });
            } else {
                maintenanceResults.innerHTML = '<div class="text-muted">Nenhuma manutenção encontrada no período.</div>';
            }

            // Exibe descontos por OS avulsas
            if (discounts.osDetails.length > 0) {
                discounts.osDetails.forEach(detail => {
                    const item = document.createElement('div');
                    item.className = 'discount-item';
                    item.innerHTML = `
                        <div><strong>OS ${detail.number}:</strong> ${detail.type}</div>
                        <div><strong>Período:</strong> ${detail.start} até ${detail.end}</div>
                        <div class="time-diff"><strong>Duração:</strong> ${detail.duration}</div>
                        ${detail.tvDiscount > 0 ? `<div><strong>Desconto TV:</strong> R$ ${detail.tvDiscount}</div>` : ''}
                        ${detail.internetDiscount > 0 ? `<div><strong>Desconto Internet:</strong> R$ ${detail.internetDiscount}</div>` : ''}
                    `;
                    osResults.appendChild(item);
                });
            } else {
                osResults.innerHTML = '<div class="text-muted">Nenhuma OS avulsa informada.</div>';
            }

            // Exibe totais
            const totalDiscountValue = discounts.totalDiscount.toFixed(2);
            totalDiscount.textContent = `R$ ${totalDiscountValue}`;

            // Exibe valores por minuto (para referência)
            const referenceInfo = document.createElement('div');
            referenceInfo.className = 'mt-3 small text-muted';
            referenceInfo.innerHTML = `
                <div><strong>Valor minuto TV:</strong> R$ ${discounts.tvPerMinute.toFixed(6)}</div>
                <div><strong>Valor minuto Internet:</strong> R$ ${discounts.internetPerMinute.toFixed(6)}</div>
                <div><strong>Base:</strong> TV R$ ${tvValue.toFixed(2)} | Internet R$ ${internetValue.toFixed(2)}</div>
            `;
            osResults.appendChild(referenceInfo);

            // Mostra o card de resultados
            resultsCard.style.display = 'block';
            resultsCard.scrollIntoView({ behavior: 'smooth' });
        }

        function formatDateTime(dateTimeString) {
            if (!dateTimeString) return '-';
            
            const date = new Date(dateTimeString);
            return date.toLocaleString('pt-BR', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function formatDuration(minutes) {
            const hours = Math.floor(minutes / 60);
            const remainingMinutes = Math.floor(minutes % 60);
            
            if (hours > 0) {
                return `${hours}h ${remainingMinutes}min`;
            } else {
                return `${remainingMinutes}min`;
            }
        }
function isDurationOver24(durationString) {
    // durationString vem no formato "Xh Ymin" ou "Zmin"
    let hours = 0;
    let minutes = 0;

    const hourMatch = durationString.match(/(\d+)h/);
    const minuteMatch = durationString.match(/(\d+)min/);

    if (hourMatch) hours = parseInt(hourMatch[1]);
    if (minuteMatch) minutes = parseInt(minuteMatch[1]);

    return (hours * 60 + minutes) >= 1440; // 1440 minutos = 24h
}

    </script>
</body>
</html>
